{"version":3,"sources":["CurrencyInput.tsx"],"names":["CurrencyInput","React","forwardRef","props","ref","renderTextInput","value","onChangeText","onChangeValue","separator","delimiter","prefix","suffix","precision","maxValue","minValue","signPosition","showPositiveSign","rest","startingWithSign","setStartingWithSign","useState","noNegativeValues","noPositiveValues","formattedValue","useMemo","ignoreNegative","useEffect","handleChangeText","useCallback","text","textWithoutPrefix","replace","slice","textWithoutPrefixAndSufix","suffixRegex","RegExp","test","sign","undefined","isNegativeValue","includes","textNumericValue","numberValue","Number","zerosOnValue","length","newValue","textInputValue","nextProps","keyboardType","selection","start","Math","max"],"mappings":";;;;;;;AAAA;;AACA;;AAEA;;;;;;AAKO,MAAMA,aAAa,gBAAGC,KAAK,CAACC,UAAN,CAAgD,UAC3EC,KAD2E,EAE3EC,GAF2E,EAG3E;AACA,QAAM;AACJC,IAAAA,eADI;AAEJC,IAAAA,KAFI;AAGJC,IAAAA,YAHI;AAIJC,IAAAA,aAJI;AAKJC,IAAAA,SALI;AAMJC,IAAAA,SANI;AAOJC,IAAAA,MAAM,GAAG,EAPL;AAQJC,IAAAA,MAAM,GAAG,EARL;AASJC,IAAAA,SAAS,GAAG,CATR;AAUJC,IAAAA,QAVI;AAWJC,IAAAA,QAXI;AAYJC,IAAAA,YAAY,GAAG,aAZX;AAaJC,IAAAA,gBAbI;AAcJ,OAAGC;AAdC,MAeFf,KAfJ;AAiBA,QAAM,CAACgB,gBAAD,EAAmBC,mBAAnB,IAA0CnB,KAAK,CAACoB,QAAN,EAAhD;AAEA,QAAMC,gBAAgB,GAAG,OAAOP,QAAP,KAAoB,QAApB,IAAgCA,QAAQ,IAAI,CAArE;AACA,QAAMQ,gBAAgB,GAAG,OAAOT,QAAP,KAAoB,QAApB,IAAgCA,QAAQ,IAAI,CAArE;AAEA,QAAMU,cAAc,GAAGvB,KAAK,CAACwB,OAAN,CAAc,MAAM;AACzC,QAAI,CAAC,CAACnB,KAAF,IAAWA,KAAK,KAAK,CAArB,IAA0BA,KAAK,KAAK,CAAC,CAAzC,EAA4C;AAC1C,aAAO,2BAAaA,KAAb,EAAoB;AACzBG,QAAAA,SADyB;AAEzBE,QAAAA,MAFyB;AAGzBC,QAAAA,MAHyB;AAIzBC,QAAAA,SAJyB;AAKzBH,QAAAA,SALyB;AAMzBgB,QAAAA,cAAc,EAAEJ,gBANS;AAOzBN,QAAAA,YAPyB;AAQzBC,QAAAA;AARyB,OAApB,CAAP;AAUD,KAXD,MAWO;AACL,aAAO,EAAP;AACD;AACF,GAfsB,EAepB,CACDX,KADC,EAEDG,SAFC,EAGDE,MAHC,EAIDC,MAJC,EAKDC,SALC,EAMDH,SANC,EAODY,gBAPC,EAQDN,YARC,EASDC,gBATC,CAfoB,CAAvB;AA2BAhB,EAAAA,KAAK,CAAC0B,SAAN,CAAgB,MAAM;AACpBpB,IAAAA,YAAY,IAAIA,YAAY,CAACiB,cAAD,CAA5B;AACD,GAFD,EAEG,CAACA,cAAD,CAFH,EAlDA,CAoDsB;;AAEtB,QAAMI,gBAAgB,GAAG3B,KAAK,CAAC4B,WAAN,CACtBC,IAAD,IAAkB;AAChB,QAAIC,iBAAiB,GAAGD,IAAxB;;AAEA,QAAInB,MAAJ,EAAY;AACVoB,MAAAA,iBAAiB,GAAGD,IAAI,CAACE,OAAL,CAAarB,MAAb,EAAqB,EAArB,CAApB;;AACA,UAAIoB,iBAAiB,KAAKD,IAA1B,EAAgC;AAC9BC,QAAAA,iBAAiB,GAAGD,IAAI,CAACE,OAAL,CAAarB,MAAM,CAACsB,KAAP,CAAa,CAAb,EAAgB,CAAC,CAAjB,CAAb,EAAkC,EAAlC,CAApB;AACD;AACF;;AAED,QAAIC,yBAAyB,GAAGH,iBAAhC;;AACA,QAAInB,MAAJ,EAAY;AACV,YAAMuB,WAAW,GAAG,IAAIC,MAAJ,WAAcxB,MAAd,gBAA0BA,MAA1B,UAApB;AACAsB,MAAAA,yBAAyB,GAAGH,iBAAiB,CAACC,OAAlB,CAA0BG,WAA1B,EAAuC,EAAvC,CAA5B;;AAEA,UAAID,yBAAyB,KAAKH,iBAAlC,EAAqD;AACnDG,QAAAA,yBAAyB,GAAGH,iBAAiB,CAACC,OAAlB,CAA0BpB,MAAM,CAACqB,KAAP,CAAa,CAAb,CAA1B,EAA2C,EAA3C,CAA5B;AACD;AACF,KAlBe,CAoBhB;;;AACA,QAAI,WAAWI,IAAX,CAAgBP,IAAhB,KAAyB,CAACR,gBAA9B,EAAgD;AAC9CF,MAAAA,mBAAmB,CAAC,GAAD,CAAnB;AACAb,MAAAA,YAAY,IACVA,YAAY,CACV,0CAAuBiB,cAAvB,EAAuC;AACrCb,QAAAA,MADqC;AAErCC,QAAAA,MAFqC;AAGrC0B,QAAAA,IAAI,EAAE,GAH+B;AAIrCtB,QAAAA;AAJqC,OAAvC,CADU,CADd;AASA;AACD,KAZD,MAYO,IAAI,aAAaqB,IAAb,CAAkBP,IAAlB,KAA2B,CAACP,gBAAhC,EAAkD;AACvDH,MAAAA,mBAAmB,CAAC,GAAD,CAAnB;AACAb,MAAAA,YAAY,IACVA,YAAY,CACV,0CAAuBiB,cAAvB,EAAuC;AACrCb,QAAAA,MADqC;AAErCC,QAAAA,MAFqC;AAGrC0B,QAAAA,IAAI,EAAE,GAH+B;AAIrCtB,QAAAA;AAJqC,OAAvC,CADU,CADd;AASD,KAXM,MAWA;AACLI,MAAAA,mBAAmB,CAACmB,SAAD,CAAnB;AACD;;AAED,UAAMC,eAAe,GAAGN,yBAAyB,CAACO,QAA1B,CAAmC,GAAnC,CAAxB;AAEA,UAAMC,gBAAgB,GAAGR,yBAAyB,CAACF,OAA1B,CAAkC,MAAlC,EAA0C,EAA1C,CAAzB;AAEA,UAAMW,WAAW,GAAGC,MAAM,CAACF,gBAAD,CAAN,IAA4BF,eAAe,GAAG,CAAC,CAAJ,GAAQ,CAAnD,CAApB;AAEA,UAAMK,YAAY,GAAGH,gBAAgB,CAACV,OAAjB,CAAyB,OAAzB,EAAkC,EAAlC,EAAsCc,MAA3D;AAEA,QAAIC,QAAJ;;AAEA,QAAI,CAACL,gBAAD,IAAsB,CAACC,WAAD,IAAgBE,YAAY,KAAKhC,SAA3D,EAAuE;AACrE;AACAkC,MAAAA,QAAQ,GAAG,IAAX;AACD,KAHD,MAGO;AACLA,MAAAA,QAAQ,GAAGJ,WAAW,GAAG,MAAM9B,SAA/B;AACD;;AAED,QAAIkC,QAAQ,IAAIjC,QAAZ,IAAwBiC,QAAQ,GAAGjC,QAAvC,EAAiD;AAC/C;AACD,KAFD,MAEO,IAAIiC,QAAQ,IAAIhC,QAAZ,IAAwBgC,QAAQ,GAAGhC,QAAvC,EAAiD;AACtD;AACD;;AAEDP,IAAAA,aAAa,IAAIA,aAAa,CAACuC,QAAD,CAA9B;AACD,GAzEsB,EA0EvB,CACEnC,MADF,EAEED,MAFF,EAGEW,gBAHF,EAIEC,gBAJF,EAKEV,SALF,EAMEC,QANF,EAOEC,QAPF,EAQEP,aARF,EASED,YATF,EAUEiB,cAVF,EAWER,YAXF,CA1EuB,CAAzB;AAyFA,QAAMgC,cAAc,GAAG/C,KAAK,CAACwB,OAAN,CAAc,MAAM;AACzC,WAAON,gBAAgB,GACnB,0CAAuBK,cAAvB,EAAuC;AACrCb,MAAAA,MADqC;AAErCC,MAAAA,MAFqC;AAGrC0B,MAAAA,IAAI,EAAEnB,gBAH+B;AAIrCH,MAAAA;AAJqC,KAAvC,CADmB,GAOnBQ,cAPJ;AAQD,GATsB,EASpB,CAACA,cAAD,EAAiBb,MAAjB,EAAyBK,YAAzB,EAAuCG,gBAAvC,EAAyDP,MAAzD,CAToB,CAAvB;AAWA,QAAMqC,SAAS,GAAGhD,KAAK,CAACwB,OAAN,CAChB,OAAO;AACLyB,IAAAA,YAAY,EAAE,SADT;AAELC,IAAAA,SAAS,EAAEvC,MAAM,GACb;AAAEwC,MAAAA,KAAK,EAAEC,IAAI,CAACC,GAAL,CAASN,cAAc,CAACF,MAAf,GAAwBlC,MAAM,CAACkC,MAAxC,EAAgD,CAAhD;AAAT,KADa,GAEb3C,KAFa,aAEbA,KAFa,uBAEbA,KAAK,CAAEgD,SAJN;AAKL,OAAGjC,IALE;AAMLZ,IAAAA,KAAK,EAAE0C,cANF;AAOLzC,IAAAA,YAAY,EAAEqB,gBAPT;AAQLxB,IAAAA,GAAG,EAAEA;AARA,GAAP,CADgB,EAWhB,CAACwB,gBAAD,EAAmBzB,KAAnB,aAAmBA,KAAnB,uBAAmBA,KAAK,CAAEgD,SAA1B,EAAqC/C,GAArC,EAA0Cc,IAA1C,EAAgDN,MAAhD,EAAwDoC,cAAxD,CAXgB,CAAlB;;AAcA,MAAI3C,eAAJ,EAAqB;AACnB,WAAOA,eAAe,CAAC4C,SAAD,CAAtB;AACD;;AAED,sBAAO,oBAAC,sBAAD,EAAeA,SAAf,CAAP;AACD,CAhL4B,CAAtB","sourcesContent":["import * as React from 'react';\nimport { TextInput } from 'react-native';\n\nimport formatNumber, { addSignPrefixAndSuffix } from './utils/formatNumber';\nimport type { CurrencyInputProps } from './props';\n\nexport type CurrencyInput = TextInput;\n\nexport const CurrencyInput = React.forwardRef<TextInput, CurrencyInputProps>(function (\n  props,\n  ref\n) {\n  const {\n    renderTextInput,\n    value,\n    onChangeText,\n    onChangeValue,\n    separator,\n    delimiter,\n    prefix = '',\n    suffix = '',\n    precision = 2,\n    maxValue,\n    minValue,\n    signPosition = 'afterPrefix',\n    showPositiveSign,\n    ...rest\n  } = props;\n\n  const [startingWithSign, setStartingWithSign] = React.useState<'-' | '+'>();\n\n  const noNegativeValues = typeof minValue === 'number' && minValue >= 0;\n  const noPositiveValues = typeof maxValue === 'number' && maxValue <= 0;\n\n  const formattedValue = React.useMemo(() => {\n    if (!!value || value === 0 || value === -0) {\n      return formatNumber(value, {\n        separator,\n        prefix,\n        suffix,\n        precision,\n        delimiter,\n        ignoreNegative: noNegativeValues,\n        signPosition,\n        showPositiveSign,\n      });\n    } else {\n      return '';\n    }\n  }, [\n    value,\n    separator,\n    prefix,\n    suffix,\n    precision,\n    delimiter,\n    noNegativeValues,\n    signPosition,\n    showPositiveSign,\n  ]);\n\n  React.useEffect(() => {\n    onChangeText && onChangeText(formattedValue);\n  }, [formattedValue]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  const handleChangeText = React.useCallback(\n    (text: string) => {\n      let textWithoutPrefix = text;\n\n      if (prefix) {\n        textWithoutPrefix = text.replace(prefix, '');\n        if (textWithoutPrefix === text) {\n          textWithoutPrefix = text.replace(prefix.slice(0, -1), '');\n        }\n      }\n\n      let textWithoutPrefixAndSufix = textWithoutPrefix;\n      if (suffix) {\n        const suffixRegex = new RegExp(`${suffix}([^${suffix}]*)$`);\n        textWithoutPrefixAndSufix = textWithoutPrefix.replace(suffixRegex, '');\n\n        if (textWithoutPrefixAndSufix === textWithoutPrefix) {\n          textWithoutPrefixAndSufix = textWithoutPrefix.replace(suffix.slice(1), '');\n        }\n      }\n\n      // Starting with a minus or plus sign\n      if (/^(-|-0)$/.test(text) && !noNegativeValues) {\n        setStartingWithSign('-');\n        onChangeText &&\n          onChangeText(\n            addSignPrefixAndSuffix(formattedValue, {\n              prefix,\n              suffix,\n              sign: '-',\n              signPosition,\n            })\n          );\n        return;\n      } else if (/^(\\+|\\+0)$/.test(text) && !noPositiveValues) {\n        setStartingWithSign('+');\n        onChangeText &&\n          onChangeText(\n            addSignPrefixAndSuffix(formattedValue, {\n              prefix,\n              suffix,\n              sign: '+',\n              signPosition,\n            })\n          );\n      } else {\n        setStartingWithSign(undefined);\n      }\n\n      const isNegativeValue = textWithoutPrefixAndSufix.includes('-');\n\n      const textNumericValue = textWithoutPrefixAndSufix.replace(/\\D+/g, '');\n\n      const numberValue = Number(textNumericValue) * (isNegativeValue ? -1 : 1);\n\n      const zerosOnValue = textNumericValue.replace(/[^0]/g, '').length;\n\n      let newValue: number | null;\n\n      if (!textNumericValue || (!numberValue && zerosOnValue === precision)) {\n        // Allow to clean the value instead of beign 0\n        newValue = null;\n      } else {\n        newValue = numberValue / 10 ** precision;\n      }\n\n      if (newValue && maxValue && newValue > maxValue) {\n        return;\n      } else if (newValue && minValue && newValue < minValue) {\n        return;\n      }\n\n      onChangeValue && onChangeValue(newValue);\n    },\n    [\n      suffix,\n      prefix,\n      noNegativeValues,\n      noPositiveValues,\n      precision,\n      maxValue,\n      minValue,\n      onChangeValue,\n      onChangeText,\n      formattedValue,\n      signPosition,\n    ]\n  );\n\n  const textInputValue = React.useMemo(() => {\n    return startingWithSign\n      ? addSignPrefixAndSuffix(formattedValue, {\n          prefix,\n          suffix,\n          sign: startingWithSign,\n          signPosition,\n        })\n      : formattedValue;\n  }, [formattedValue, prefix, signPosition, startingWithSign, suffix]);\n\n  const nextProps = React.useMemo(\n    () => ({\n      keyboardType: 'numeric' as const,\n      selection: suffix\n        ? { start: Math.max(textInputValue.length - suffix.length, 0) }\n        : props?.selection,\n      ...rest,\n      value: textInputValue,\n      onChangeText: handleChangeText,\n      ref: ref,\n    }),\n    [handleChangeText, props?.selection, ref, rest, suffix, textInputValue]\n  );\n\n  if (renderTextInput) {\n    return renderTextInput(nextProps);\n  }\n\n  return <TextInput {...nextProps} />;\n});\n"]}